// server/prisma/schema.prisma

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  username  String   @unique
  email     String   @unique
  password  String
  balance   Float    @default(10000.00) // Starting Fake Money: $10k
  createdAt DateTime @default(now())

  // Relations
  trades   Trade[]
  holdings Holding[]
}

model Trade {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  symbol      String
  type        String // "BUY" or "SELL"
  quantity    Float
  price       Float
  totalCost   Float
  realizedPnl Float? // <--- ADD THIS (Nullable, because BUYs don't have PnL)
  createdAt   DateTime @default(now())
}

model Holding {
  id String @id @default(uuid())

  // Foreign Key to User
  userId String
  user   User   @relation(fields: [userId], references: [id])

  symbol   String // e.g. "BTCUSDT"
  quantity Float // Total owned
  avgPrice Float // Average entry price

  // In SQL, we ensure a user can't have duplicate entries for the same coin
  @@unique([userId, symbol])
}
